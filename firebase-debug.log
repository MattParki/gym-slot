[debug] [2025-05-24T09:34:19.772Z] ----------------------------------------------------------------------
[debug] [2025-05-24T09:34:19.778Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\mattp\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js functions:shell
[debug] [2025-05-24T09:34:19.779Z] CLI Version:   14.2.1
[debug] [2025-05-24T09:34:19.779Z] Platform:      win32
[debug] [2025-05-24T09:34:19.779Z] Node Version:  v20.17.0
[debug] [2025-05-24T09:34:19.780Z] Time:          Sat May 24 2025 10:34:19 GMT+0100 (British Summer Time)
[debug] [2025-05-24T09:34:19.780Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-05-24T09:34:20.193Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-05-24T09:34:20.194Z] > authorizing via signed-in user (breakfreedigitalltd@gmail.com)
[debug] [2025-05-24T09:34:20.194Z] [iam] checking project proposalai-87cae for permissions ["firebase.projects.get"]
[debug] [2025-05-24T09:34:20.196Z] Checked if tokens are valid: false, expires at: 1748080127097
[debug] [2025-05-24T09:34:20.197Z] Checked if tokens are valid: false, expires at: 1748080127097
[debug] [2025-05-24T09:34:20.197Z] > refreshing access token with scopes: []
[debug] [2025-05-24T09:34:20.200Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2025-05-24T09:34:20.200Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-05-24T09:34:20.581Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2025-05-24T09:34:20.582Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-05-24T09:34:20.600Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions [none]
[debug] [2025-05-24T09:34:20.600Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions x-goog-quota-user=projects/proposalai-87cae
[debug] [2025-05-24T09:34:20.600Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2025-05-24T09:34:21.018Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions 200
[debug] [2025-05-24T09:34:21.019Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2025-05-24T09:34:21.027Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-24T09:34:21.046Z] defaultcredentials: writing to file C:\Users\mattp\AppData\Roaming\firebase\breakfreedigitalltd_gmail_com_application_default_credentials.json
[debug] [2025-05-24T09:34:21.051Z] DEBUG: Setting GAC to C:\Users\mattp\AppData\Roaming\firebase\breakfreedigitalltd_gmail_com_application_default_credentials.json
[debug] [2025-05-24T09:34:21.052Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:34:21.052Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:34:21.052Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/proposalai-87cae/adminSdkConfig [none]
[debug] [2025-05-24T09:34:21.503Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/proposalai-87cae/adminSdkConfig 200
[debug] [2025-05-24T09:34:21.503Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/proposalai-87cae/adminSdkConfig {"projectId":"proposalai-87cae","storageBucket":"proposalai-87cae.firebasestorage.app"}
[debug] [2025-05-24T09:34:21.521Z] [functions] Watching "C:\Users\mattp\Downloads\proposal-ai\functions" for Cloud Functions...
[debug] [2025-05-24T09:34:21.533Z] Validating nodejs source
[warn] !  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] !  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-05-24T09:34:23.262Z] > [functions] package.json contents: {
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.10.1",
    "firebase-functions": "^4.4.1",
    "stripe": "^18.0.0"
  },
  "devDependencies": {
    "firebase-functions-test": "^3.1.0"
  },
  "private": true
}
[debug] [2025-05-24T09:34:23.263Z] Building nodejs source
[debug] [2025-05-24T09:34:23.264Z] Failed to find version of module node: reached end of search path C:\Users\mattp\Downloads\proposal-ai\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "20". Using node@20 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-05-24T09:34:23.269Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-24T09:34:23.283Z] Found firebase-functions binary at 'C:\Users\mattp\Downloads\proposal-ai\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8861

[debug] [2025-05-24T09:34:24.424Z] Got response from /__/functions.yaml {"endpoints":{"checkAndUpdateProposals":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 0 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkAndUpdateProposals"},"checkEmailActivityAndNotify":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 1 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkEmailActivityAndNotify"},"stripeWebhook":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"stripeWebhook"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}]}
[debug] [2025-05-24T09:34:29.480Z] [functions] Loaded functions definitions from source: checkAndUpdateProposals, checkEmailActivityAndNotify, stripeWebhook.
[debug] [2025-05-24T09:34:29.481Z] [functions[us-central1-checkAndUpdateProposals]] function ignored because the pubsub emulator does not exist or is not running.
[debug] [2025-05-24T09:34:29.482Z] [functions[us-central1-checkEmailActivityAndNotify]] function ignored because the pubsub emulator does not exist or is not running.
[debug] [2025-05-24T09:34:29.482Z] [functions[us-central1-stripeWebhook]] http function initialized (http://127.0.0.1:5000/proposalai-87cae/us-central1/stripeWebhook).
[info] i  functions: Loaded functions: checkAndUpdateProposals, checkEmailActivityAndNotify, stripeWebhook 
[warn] !  functions: The following emulators are not running, calls to these services will affect production: firestore, database, pubsub, storage, eventarc, tasks 
[debug] [2025-05-24T09:34:48.981Z] shell:checkEmailActivityAndNotify: trigger={"entryPoint":"checkEmailActivityAndNotify","platform":"gcfv1","region":"us-central1","name":"checkEmailActivityAndNotify","id":"us-central1-checkEmailActivityAndNotify","codebase":"default","availableMemoryMb":256,"labels":{"EVENTARC_CLOUD_EVENT_SOURCE":"cloudfunctions-emulated.googleapis.com/projects/proposalai-87cae/locations/us-central1/functions/checkEmailActivityAndNotify"},"timeoutSeconds":60,"secretEnvironmentVariables":[],"eventTrigger":{"eventType":"pubsub","resource":""},"schedule":{"schedule":"0 1 * * *","timeZone":"UTC","retryConfig":{"maxBackoffSeconds":null,"minBackoffSeconds":null,"maxRetrySeconds":null,"retryCount":null,"maxDoublings":null}}}
[debug] [2025-05-24T09:34:48.982Z] shell:checkEmailActivityAndNotify: opts={}, data={}
[debug] [2025-05-24T09:34:49.010Z] DEBUG: [worker-pool] addWorker(us-central1-checkEmailActivityAndNotify)
[debug] [2025-05-24T09:34:49.011Z] DEBUG: [worker-pool] Adding worker with key us-central1-checkEmailActivityAndNotify, total=1
[debug] [2025-05-24T09:34:51.317Z] DEBUG: [runtime-status] [5060] Resolved module firebase-admin {"declared":true,"installed":true,"version":"11.11.1","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-admin\\lib\\index.js"}
[debug] [2025-05-24T09:34:51.320Z] DEBUG: [runtime-status] [5060] Resolved module firebase-functions {"declared":true,"installed":true,"version":"4.9.0","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-functions\\lib\\v1\\index.js"}
[debug] [2025-05-24T09:34:51.321Z] DEBUG: [runtime-status] [5060] Found local functions config: C:\Users\mattp\Downloads\proposal-ai\functions/.runtimeconfig.json
[debug] [2025-05-24T09:34:51.322Z] DEBUG: [runtime-status] [5060] Outgoing network have been stubbed. [{"name":"http","status":"mocked"},{"name":"http","status":"mocked"},{"name":"https","status":"mocked"},{"name":"https","status":"mocked"},{"name":"net","status":"mocked"}]
[debug] [2025-05-24T09:34:51.323Z] DEBUG: [runtime-status] [5060] Resolved module firebase-functions {"declared":true,"installed":true,"version":"4.9.0","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-functions\\lib\\v1\\index.js"}
[debug] [2025-05-24T09:34:51.798Z] DEBUG: [runtime-status] [5060] Checked functions.config() {"config":{"stripe":{"webhook_secret":"whsec_jfETdH3d3dL0VrPdAUugjrD8Q8rn8hsm","secret_key":"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"}}}
[debug] [2025-05-24T09:34:51.799Z] DEBUG: [runtime-status] [5060] firebase-functions has been stubbed. {"functionsResolution":{"declared":true,"installed":true,"version":"4.9.0","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-functions\\lib\\v1\\index.js"}}
[debug] [2025-05-24T09:34:51.800Z] DEBUG: [runtime-status] [5060] Resolved module firebase-functions {"declared":true,"installed":true,"version":"4.9.0","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-functions\\lib\\v1\\index.js"}
[debug] [2025-05-24T09:34:51.803Z] DEBUG: [runtime-status] [5060] Resolved module firebase-admin {"declared":true,"installed":true,"version":"11.11.1","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-admin\\lib\\index.js"}
[debug] [2025-05-24T09:34:51.808Z] DEBUG: [runtime-status] [5060] Resolved module firebase-functions {"declared":true,"installed":true,"version":"4.9.0","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-functions\\lib\\v1\\index.js"}
[debug] [2025-05-24T09:34:51.809Z] DEBUG: [runtime-status] [5060] firebase-admin has been stubbed. {"adminResolution":{"declared":true,"installed":true,"version":"11.11.1","resolution":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions\\node_modules\\firebase-admin\\lib\\index.js"}}
[debug] [2025-05-24T09:34:52.171Z] DEBUG: [runtime-status] [5060] initializeApp(DEFAULT) {"storageBucket":"proposalai-87cae.firebasestorage.app","projectId":"proposalai-87cae"}
[warn] !  functions: The Cloud Firestore emulator is not running, so calls to Firestore will affect production. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-checkEmailActivityAndNotify"},"extension":{},"message":"The Cloud Firestore emulator is not running, so calls to Firestore will affect production."}}
[debug] [2025-05-24T09:34:52.189Z] DEBUG: [runtime-status] [5060] Functions runtime initialized. {"cwd":"C:\\Users\\mattp\\Downloads\\proposal-ai\\functions","node_version":"20.17.0"}
[debug] [2025-05-24T09:34:52.189Z] DEBUG: [runtime-status] [5060] Listening to port: \\?\pipe\fire_emu_278e893c2c9182a0
[debug] [2025-05-24T09:34:52.253Z] DEBUG: [worker-us-central1-checkEmailActivityAndNotify-864c4027-bbfa-40f6-ac6e-7043a1e22b13]: IDLE
[debug] [2025-05-24T09:34:52.274Z] DEBUG: [runtime-status] [5060] RunBackground {"data":{},"context":{"eventId":"90299f49-8a2f-4b7e-82e5-76c07240be3a","timestamp":"2025-05-24T09:34:48.982Z","eventType":"pubsub","auth":{"admin":false}}}
[warn] !  Google API requested!
   - URL: "https://oauth2.googleapis.com/token"
   - Be careful, this may be a production service. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-checkEmailActivityAndNotify"},"extension":{},"message":"Google API requested!\n   - URL: \"https://oauth2.googleapis.com/token\"\n   - Be careful, this may be a production service."}}
[info] >  Matt Parkinson lead 0 5 null {"user":"Matt Parkinson lead 0 5 null","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-checkEmailActivityAndNotify"},"extension":{},"message":"\u001b[90m> \u001b[39m Matt Parkinson lead 0 5 null"}}
[info] >  N/A prospect 1 3 null {"user":"N/A prospect 1 3 null","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-checkEmailActivityAndNotify"},"extension":{},"message":"\u001b[90m> \u001b[39m N/A prospect 1 3 null"}}
[info] >  Tom Grupa lead 1 3 0 {"user":"Tom Grupa lead 1 3 0","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-checkEmailActivityAndNotify"},"extension":{},"message":"\u001b[90m> \u001b[39m Tom Grupa lead 1 3 0"}}
[info] >  N/A prospect 1 0 null {"user":"N/A prospect 1 0 null","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-checkEmailActivityAndNotify"},"extension":{},"message":"\u001b[90m> \u001b[39m N/A prospect 1 0 null"}}
[info] >  Created 1 notifications {"user":"Created 1 notifications","metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-checkEmailActivityAndNotify"},"extension":{},"message":"\u001b[90m> \u001b[39m Created 1 notifications"}}
[debug] [2025-05-24T09:36:33.477Z] DEBUG: File C:\Users\mattp\Downloads\proposal-ai\functions\index.js changed, reloading triggers
[debug] [2025-05-24T09:36:34.488Z] Validating nodejs source
[warn] !  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] !  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-05-24T09:36:36.480Z] > [functions] package.json contents: {
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.10.1",
    "firebase-functions": "^4.4.1",
    "stripe": "^18.0.0"
  },
  "devDependencies": {
    "firebase-functions-test": "^3.1.0"
  },
  "private": true
}
[debug] [2025-05-24T09:36:36.480Z] Building nodejs source
[debug] [2025-05-24T09:36:36.480Z] Failed to find version of module node: reached end of search path C:\Users\mattp\Downloads\proposal-ai\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "20". Using node@20 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-05-24T09:36:36.483Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-24T09:36:36.496Z] Found firebase-functions binary at 'C:\Users\mattp\Downloads\proposal-ai\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8204

[debug] [2025-05-24T09:36:37.978Z] Got response from /__/functions.yaml {"endpoints":{"checkAndUpdateProposals":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 0 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkAndUpdateProposals"},"checkEmailActivityAndNotify":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 1 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkEmailActivityAndNotify"},"stripeWebhook":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"stripeWebhook"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}]}
[debug] [2025-05-24T09:36:43.020Z] [functions] Loaded functions definitions from source: checkAndUpdateProposals, checkEmailActivityAndNotify, stripeWebhook.
[debug] [2025-05-24T09:36:43.021Z] DEBUG: [worker-pool] Shutting down IDLE worker (us-central1-checkEmailActivityAndNotify)
[debug] [2025-05-24T09:36:43.021Z] DEBUG: [worker-us-central1-checkEmailActivityAndNotify-864c4027-bbfa-40f6-ac6e-7043a1e22b13]: FINISHING
[debug] [2025-05-24T09:36:43.037Z] DEBUG: [worker-us-central1-checkEmailActivityAndNotify-864c4027-bbfa-40f6-ac6e-7043a1e22b13]: exited
[debug] [2025-05-24T09:36:43.037Z] DEBUG: [worker-us-central1-checkEmailActivityAndNotify-864c4027-bbfa-40f6-ac6e-7043a1e22b13]: FINISHED
[debug] [2025-05-24T09:37:04.244Z] DEBUG: File C:\Users\mattp\Downloads\proposal-ai\functions\index.js changed, reloading triggers
[debug] [2025-05-24T09:37:05.254Z] Validating nodejs source
[warn] !  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] !  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-05-24T09:37:07.850Z] > [functions] package.json contents: {
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.10.1",
    "firebase-functions": "^4.4.1",
    "stripe": "^18.0.0"
  },
  "devDependencies": {
    "firebase-functions-test": "^3.1.0"
  },
  "private": true
}
[debug] [2025-05-24T09:37:07.851Z] Building nodejs source
[debug] [2025-05-24T09:37:07.851Z] Failed to find version of module node: reached end of search path C:\Users\mattp\Downloads\proposal-ai\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "20". Using node@20 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-05-24T09:37:07.853Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-24T09:37:07.864Z] Found firebase-functions binary at 'C:\Users\mattp\Downloads\proposal-ai\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8173

[debug] [2025-05-24T09:37:08.940Z] Got response from /__/functions.yaml {"endpoints":{"checkAndUpdateProposals":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 0 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkAndUpdateProposals"},"checkEmailActivityAndNotify":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 1 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkEmailActivityAndNotify"},"stripeWebhook":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"stripeWebhook"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}]}
[debug] [2025-05-24T09:37:14.008Z] [functions] Loaded functions definitions from source: checkAndUpdateProposals, checkEmailActivityAndNotify, stripeWebhook.
[debug] [2025-05-24T09:37:15.564Z] ----------------------------------------------------------------------
[debug] [2025-05-24T09:37:15.570Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\mattp\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only functions:checkEmailActivityAndNotify
[debug] [2025-05-24T09:37:15.571Z] CLI Version:   14.2.1
[debug] [2025-05-24T09:37:15.572Z] Platform:      win32
[debug] [2025-05-24T09:37:15.572Z] Node Version:  v20.17.0
[debug] [2025-05-24T09:37:15.572Z] Time:          Sat May 24 2025 10:37:15 GMT+0100 (British Summer Time)
[debug] [2025-05-24T09:37:15.573Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-05-24T09:37:16.052Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-05-24T09:37:16.053Z] > authorizing via signed-in user (breakfreedigitalltd@gmail.com)
[debug] [2025-05-24T09:37:16.053Z] [iam] checking project proposalai-87cae for permissions ["cloudfunctions.functions.create","cloudfunctions.functions.delete","cloudfunctions.functions.get","cloudfunctions.functions.list","cloudfunctions.functions.update","cloudfunctions.operations.get","firebase.projects.get"]
[debug] [2025-05-24T09:37:16.055Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:16.055Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:16.058Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions [none]
[debug] [2025-05-24T09:37:16.058Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions x-goog-quota-user=projects/proposalai-87cae
[debug] [2025-05-24T09:37:16.058Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions {"permissions":["cloudfunctions.functions.create","cloudfunctions.functions.delete","cloudfunctions.functions.get","cloudfunctions.functions.list","cloudfunctions.functions.update","cloudfunctions.operations.get","firebase.projects.get"]}
[debug] [2025-05-24T09:37:16.498Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions 200
[debug] [2025-05-24T09:37:16.499Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae:testIamPermissions {"permissions":["cloudfunctions.functions.create","cloudfunctions.functions.delete","cloudfunctions.functions.get","cloudfunctions.functions.list","cloudfunctions.functions.update","cloudfunctions.operations.get","firebase.projects.get"]}
[debug] [2025-05-24T09:37:16.499Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:16.500Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:16.501Z] >>> [apiv2][query] POST https://iam.googleapis.com/v1/projects/proposalai-87cae/serviceAccounts/proposalai-87cae@appspot.gserviceaccount.com:testIamPermissions [none]
[debug] [2025-05-24T09:37:16.501Z] >>> [apiv2][body] POST https://iam.googleapis.com/v1/projects/proposalai-87cae/serviceAccounts/proposalai-87cae@appspot.gserviceaccount.com:testIamPermissions {"permissions":["iam.serviceAccounts.actAs"]}
[debug] [2025-05-24T09:37:17.418Z] <<< [apiv2][status] POST https://iam.googleapis.com/v1/projects/proposalai-87cae/serviceAccounts/proposalai-87cae@appspot.gserviceaccount.com:testIamPermissions 200
[debug] [2025-05-24T09:37:17.418Z] <<< [apiv2][body] POST https://iam.googleapis.com/v1/projects/proposalai-87cae/serviceAccounts/proposalai-87cae@appspot.gserviceaccount.com:testIamPermissions {"permissions":["iam.serviceAccounts.actAs"]}
[info] 
[info] === Deploying to 'proposalai-87cae'...
[info] 
[info] i  deploying functions 
[debug] [2025-05-24T09:37:17.425Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.425Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.425Z] >>> [apiv2][query] GET https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae [none]
[debug] [2025-05-24T09:37:17.558Z] DEBUG: File C:\Users\mattp\Downloads\proposal-ai\functions\index.js changed, reloading triggers
[debug] [2025-05-24T09:37:17.653Z] <<< [apiv2][status] GET https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae 200
[debug] [2025-05-24T09:37:17.654Z] <<< [apiv2][body] GET https://cloudresourcemanager.googleapis.com/v1/projects/proposalai-87cae {"projectNumber":"205542612658","projectId":"proposalai-87cae","lifecycleState":"ACTIVE","name":"ProspectsEasy","labels":{"firebase":"enabled","firebase-core":"disabled"},"createTime":"2025-04-15T17:46:23.682564Z"}
[info] i  functions: preparing codebase default for deployment 
[info] i  functions: ensuring required API cloudfunctions.googleapis.com is enabled... 
[debug] [2025-05-24T09:37:17.657Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.658Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.658Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.658Z] Checked if tokens are valid: true, expires at: 1748082859582
[info] i  functions: ensuring required API cloudbuild.googleapis.com is enabled... 
[debug] [2025-05-24T09:37:17.659Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.659Z] Checked if tokens are valid: true, expires at: 1748082859582
[info] i  artifactregistry: ensuring required API artifactregistry.googleapis.com is enabled... 
[debug] [2025-05-24T09:37:17.660Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.660Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:17.660Z] >>> [apiv2][query] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudfunctions.googleapis.com [none]
[debug] [2025-05-24T09:37:17.660Z] >>> [apiv2][(partial)header] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudfunctions.googleapis.com x-goog-quota-user=projects/proposalai-87cae
[debug] [2025-05-24T09:37:17.662Z] >>> [apiv2][query] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/runtimeconfig.googleapis.com [none]
[debug] [2025-05-24T09:37:17.663Z] >>> [apiv2][(partial)header] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/runtimeconfig.googleapis.com x-goog-quota-user=projects/proposalai-87cae
[debug] [2025-05-24T09:37:17.664Z] >>> [apiv2][query] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudbuild.googleapis.com [none]
[debug] [2025-05-24T09:37:17.665Z] >>> [apiv2][(partial)header] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudbuild.googleapis.com x-goog-quota-user=projects/proposalai-87cae
[debug] [2025-05-24T09:37:17.667Z] >>> [apiv2][query] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/artifactregistry.googleapis.com [none]
[debug] [2025-05-24T09:37:17.667Z] >>> [apiv2][(partial)header] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/artifactregistry.googleapis.com x-goog-quota-user=projects/proposalai-87cae
[debug] [2025-05-24T09:37:18.560Z] Validating nodejs source
[debug] [2025-05-24T09:37:18.755Z] <<< [apiv2][status] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/runtimeconfig.googleapis.com 200
[debug] [2025-05-24T09:37:18.755Z] <<< [apiv2][body] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/runtimeconfig.googleapis.com [omitted]
[debug] [2025-05-24T09:37:18.758Z] <<< [apiv2][status] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/artifactregistry.googleapis.com 200
[debug] [2025-05-24T09:37:18.758Z] <<< [apiv2][body] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/artifactregistry.googleapis.com [omitted]
[info] +  artifactregistry: required API artifactregistry.googleapis.com is enabled 
[debug] [2025-05-24T09:37:18.760Z] <<< [apiv2][status] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudbuild.googleapis.com 200
[debug] [2025-05-24T09:37:18.760Z] <<< [apiv2][body] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudbuild.googleapis.com [omitted]
[info] +  functions: required API cloudbuild.googleapis.com is enabled 
[debug] [2025-05-24T09:37:18.768Z] <<< [apiv2][status] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudfunctions.googleapis.com 200
[debug] [2025-05-24T09:37:18.769Z] <<< [apiv2][body] GET https://serviceusage.googleapis.com/v1/projects/proposalai-87cae/services/cloudfunctions.googleapis.com [omitted]
[info] +  functions: required API cloudfunctions.googleapis.com is enabled 
[debug] [2025-05-24T09:37:18.770Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:18.770Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:18.771Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/proposalai-87cae/adminSdkConfig [none]
[debug] [2025-05-24T09:37:19.210Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/proposalai-87cae/adminSdkConfig 200
[debug] [2025-05-24T09:37:19.211Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/proposalai-87cae/adminSdkConfig {"projectId":"proposalai-87cae","storageBucket":"proposalai-87cae.firebasestorage.app"}
[debug] [2025-05-24T09:37:19.211Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.212Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.212Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs [none]
[debug] [2025-05-24T09:37:19.671Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs 200
[debug] [2025-05-24T09:37:19.671Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs {"configs":[{"name":"projects/proposalai-87cae/configs/stripe"}]}
[debug] [2025-05-24T09:37:19.671Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.672Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.672Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables [none]
[debug] [2025-05-24T09:37:19.921Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables 200
[debug] [2025-05-24T09:37:19.921Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables {"variables":[{"name":"projects/proposalai-87cae/configs/stripe/variables/secret_key","updateTime":"2025-05-03T17:21:50.681011099Z"},{"name":"projects/proposalai-87cae/configs/stripe/variables/webhook_secret","updateTime":"2025-05-03T17:21:50.682091660Z"}]}
[debug] [2025-05-24T09:37:19.921Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.921Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.922Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.922Z] Checked if tokens are valid: true, expires at: 1748082859582
[debug] [2025-05-24T09:37:19.922Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables/secret_key [none]
[debug] [2025-05-24T09:37:19.923Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables/webhook_secret [none]
[debug] [2025-05-24T09:37:20.155Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables/secret_key 200
[debug] [2025-05-24T09:37:20.155Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables/secret_key {"name":"projects/proposalai-87cae/configs/stripe/variables/secret_key","updateTime":"2025-05-03T17:21:50.681011099Z","text":"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"}
[debug] [2025-05-24T09:37:20.258Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables/webhook_secret 200
[debug] [2025-05-24T09:37:20.258Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/proposalai-87cae/configs/stripe/variables/webhook_secret {"name":"projects/proposalai-87cae/configs/stripe/variables/webhook_secret","updateTime":"2025-05-03T17:21:50.682091660Z","text":"whsec_jfETdH3d3dL0VrPdAUugjrD8Q8rn8hsm"}
[warn] !  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] !  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-05-24T09:37:20.413Z] > [functions] package.json contents: {
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.10.1",
    "firebase-functions": "^4.4.1",
    "stripe": "^18.0.0"
  },
  "devDependencies": {
    "firebase-functions-test": "^3.1.0"
  },
  "private": true
}
[debug] [2025-05-24T09:37:20.414Z] Building nodejs source
[debug] [2025-05-24T09:37:20.414Z] Failed to find version of module node: reached end of search path C:\Users\mattp\Downloads\proposal-ai\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "20". Using node@20 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-05-24T09:37:20.429Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-24T09:37:20.443Z] Found firebase-functions binary at 'C:\Users\mattp\Downloads\proposal-ai\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8730

[debug] [2025-05-24T09:37:22.813Z] Got response from /__/functions.yaml {"endpoints":{"checkAndUpdateProposals":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 0 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkAndUpdateProposals"},"checkEmailActivityAndNotify":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 1 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkEmailActivityAndNotify"},"stripeWebhook":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"stripeWebhook"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}]}
[debug] [2025-05-24T09:37:20.262Z] Validating nodejs source
[warn] !  functions: Runtime Node.js 18 was deprecated on 2025-04-30 and will be decommissioned on 2025-10-31, after which you will not be able to deploy without upgrading. Consider upgrading now to avoid disruption. See https://cloud.google.com/functions/docs/runtime-support for full details on the lifecycle policy 
[warn] !  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] !  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-05-24T09:37:23.273Z] > [functions] package.json contents: {
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.10.1",
    "firebase-functions": "^4.4.1",
    "stripe": "^18.0.0"
  },
  "devDependencies": {
    "firebase-functions-test": "^3.1.0"
  },
  "private": true
}
[debug] [2025-05-24T09:37:23.273Z] Building nodejs source
[info] i  functions: Loading and analyzing source code for codebase default to determine what to deploy 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-05-24T09:37:23.281Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-24T09:37:23.298Z] Found firebase-functions binary at 'C:\Users\mattp\Downloads\proposal-ai\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8826

[debug] [2025-05-24T09:37:24.856Z] Got response from /__/functions.yaml {"endpoints":{"checkAndUpdateProposals":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 0 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkAndUpdateProposals"},"checkEmailActivityAndNotify":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"scheduleTrigger":{"schedule":"0 1 * * *","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetryDuration":null,"maxBackoffDuration":null,"minBackoffDuration":null},"timeZone":"UTC"},"labels":{},"entryPoint":"checkEmailActivityAndNotify"},"stripeWebhook":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"stripeWebhook"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}]}
